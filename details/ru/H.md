# Введение
Это детальная документация к коду.

Идея детальной документации заключается в том, что всегда
легко объяснить, что делает функция, но чтобы понять как
она это делает нужно знать множество деталей.

Как говорится "дьявол в деталях". В результате мы в коде
описываем только "что делает каждая функция" и расставляем
ссылки на детали в виде @DetailName. А сами детали мы
описываем в директории details.

Каждая ссылка может быть использована несколько раз.
Мы не переводим комментарии, но можем захотеть перевести
детали на несколько языков.

# @H6PFormat
Формат H6P весьма прост и вероятно напомнит BMP.

Все числа хранятся в Big-Endian формате.

Заголовок 4 байта содержит Magic-последовательность "HexP".

Далее 4 байта &mdash; версия формата (=2).

Ещё 4 байта &mdash; ширина (w).

И 4 байта &mdash; высота (h).

Наконец 4\*w\*h байт информация о каждом гексагональном пикселе.

Информация эта состоит из:

18 старших бит &mdash; цвет из оптимальной палитры (@OptimalPalette)

10 следующих бит &mdash; субпиксельная информация, номер формы дополнительного цвета.

4 младших бит &mdash; субпиксельная информация, номер дополнительного цвета.

# @H6PMask
Номер формы дополнительного цвета кодирует одну из 655 возможных форм.

Все формы складываются из от одной до четырёх непересекающихся областей
гиперпикселя (@HyperMask).

Нулевая форма &mdash; это весь гексогон (49-я область) и означает
отсутствие дополнительного цвета.

Формы 1-48 соответствуют областям от 0 до 47.

Далее идут всевозможные сочетания непересекающихся областей,
которые генерируются в функции gen\_forms модуля hexpict.hyperpixel

Наконец форма 654 соответствует области 48. 

# @HyperMask
В шестиугольном пикселе мы выделяем 50 областей.

Все области сгруппированы по подобию и представлены на
следующих 5 рисунках:

![Области гиперпикселя 0-11](../pictures/areas_0-11.png)
![Области гиперпикселя 12-23](../pictures/areas_12-23.png)

![Области гиперпикселя 24-35](../pictures/areas_24-35.png)
![Области гиперпикселя 36-47](../pictures/areas_36-47.png)

![Области гиперпикселя 48-49](../pictures/areas_48-49.png)

В связи с этим для каждого пикселя гиперпикселя
формируется маска принадлежности каждой области.

Маска пикселя &mdash; это 64-хбитное целое число 50 битов которой
соответствует принадлежности одной из областей.


# @HyperPixel
Гиперпиксель &mdash; это представление гексогонального
пикселя в виде некоторого набора обычных пикселей.

Одно из представлений гиперпикселя можно найти
[здесь](https://en.wikipedia.org/wiki/User:Smcgruer).

Важно, чтобы гиперпиксели укладывались на плоскости
квадратной сетки из обычных пикселей
не оставляя зазоров. В связи с этим не для каждой
ширины удаётся (@HyperPixelSuccess) сгенерировать
симметричный гиперпиксель.

# @HyperPixelSuccess
Итак как было отмечено в @HyperPixel не для каждой
ширины удаётся сгенерировать симметричный гиперпиксель
так чтобы замостить пиксельную сетку без зазоров.

Для проверки отсутствия зазоров мы проверяем поочерёдно
соответствие ширины каждой линии гиперпикселя ширине
пространства между двумя уложенными рядом гиперпикселями.
